<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SLMMS Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<style>
body, html { margin:0; padding:0; font-family:'Poppins',sans-serif; background:#f5f6fa; color:#333; transition: all 0.3s; }
.dark-mode { background:#1e1e2f; color:#f5f5f5; }
.topbar { position:fixed; top:0; left:0; width:100%; height:60px; background:#4CAF50; display:flex; align-items:center; padding:0 20px; box-shadow:0 2px 6px rgba(0,0,0,0.15); z-index:100; }
.topbar img {
    height: 40px;
    position: relative;
    border-bottom-left-radius: -50px; 
}

button { cursor:pointer; padding:8px 14px; border:none; border-radius:6px; background:#4CAF50; color:#fff; font-weight:500; }
button.secondary { background:#e74c3c; }
.sidebar { position:fixed; top:0; left:0; width:250px; height:100%; background:#2f3640; color:#fff; transition: transform 0.3s; transform: translateX(0); padding-top:70px; z-index:99; }
.sidebar.hidden { transform: translateX(-260px); }
.sidebar ul { list-style:none; padding:0; margin:0; }
.sidebar ul li { padding:15px 20px; margin:5px 10px; border-radius:8px; display:flex; justify-content:space-between; align-items:center; cursor:pointer; transition: background 0.2s; }
.sidebar ul li:hover { background:#3b414d; }
.bubble { background:#e84118; color:#fff; border-radius:50%; padding:4px 8px; font-size:12px; }
.content { margin-left:250px; padding:80px 20px 20px 20px; transition: margin-left 0.3s; }
.content.full { margin-left:0; }
.card { background:#fff; border-radius:10px; padding:20px; margin-bottom:20px; box-shadow:0 4px 12px rgba(0,0,0,0.1); transition: transform 0.2s; }
.card:hover { transform: translateY(-3px); }
.pc-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:20px; margin-top:20px; }
.pc-card { background:#fff; border-radius:10px; padding:15px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.08); transition: transform 0.2s; }
.pc-card:hover { transform: translateY(-3px); }
.pc-status.online { color:#27ae60; font-weight:600; }
.pc-status.idle { color:#f39c12; font-weight:600; }
.pc-status.offline { color:#e74c3c; font-weight:600; }
.stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-top:20px; }
.stats-card { background:#fff; border-radius:12px; padding:20px; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
.stats-card h2 { margin:0; font-size:28px; color:#4CAF50; }
.user-card { background:#fff; padding:18px; margin-bottom:15px; border-radius:10px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
.user-card:hover { transform: translateY(-2px); }
.actions { display:flex; gap:10px; flex-wrap:wrap; }
.actions input[type="text"] { padding:6px 10px; border-radius:5px; border:1px solid #ccc; min-width:140px; }
.approve-btn { background:#27ae60; color:white; }
.reject-btn { background:#e74c3c; color:white; }
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:200; }
.modal-content { background:#fff; padding:30px; border-radius:12px; width:350px; text-align:center; box-shadow:0 8px 20px rgba(0,0,0,0.2); }
.modal-content.dark-mode { background:#2c2c3c; color:#f5f5f5; }
.modal-content input { width:100%; padding:12px; margin:15px 0; border-radius:6px; border:1px solid #ccc; font-size:14px; }
.modal-content button { width:48%; }
</style>
</head>
<body>

<div class="topbar">
    <button onclick="toggleSidebar()">â˜°</button>
    <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo">

</div>

<div class="sidebar" id="sidebar">
    <ul>
        <li onclick="showHome()">Home</li>
        <li onclick="showPending()">Pending Approvals <span class="bubble">{{ pending_users|length }}</span></li>
        <li onclick="showActive()">Active PCs</li>
        <li onclick="showLogs()">Logs</li>
        <li onclick="showSettings()">Settings</li>
        <li onclick="logout()">Logout</li>
    </ul>
</div>

<div class="content" id="content">
    <div id="main-area">
        <h1>Welcome to SLMMS Dashboard</h1>
        <p>Select a menu from the sidebar to view details.</p>

        <!-- PC stats -->
        <div class="stats-grid">
            <div class="stats-card"><h2>{{ pcs_total }}</h2><p>Total PCs</p></div>
            <div class="stats-card"><h2>{{ pcs_online }}</h2><p>Online</p></div>
            <div class="stats-card"><h2>{{ pcs_idle }}</h2><p>Idle</p></div>
            <div class="stats-card"><h2>{{ pcs_offline }}</h2><p>Offline</p></div>
        </div>

        <!-- Pending Users -->
        {% if pending_users %}
        <h2 style="margin-top:30px;">Pending Approvals</h2>
        {% for user in pending_users %}
        <div class="user-card">
            <div>{{ user[1] }} - {{ user[2] }}</div>
            <div class="actions">
                <button onclick="approveUser('{{ user[0] }}')" class="approve-btn">Approve</button>
                <button onclick="openRejectModal('{{ user[0] }}')" class="reject-btn">Reject</button>
            </div>
        </div>
        {% endfor %}
        {% endif %}
    </div>
</div>

<div class="modal" id="rejectModal">
    <div class="modal-content" id="modalContent">
        <h3>Reject User</h3>
        <input type="text" id="rejectReason" placeholder="Enter reason">
        <div style="display:flex; justify-content:space-between;">
            <button onclick="submitReject()" class="reject-btn">Reject</button>
            <button onclick="closeRejectModal()">Cancel</button>
        </div>
    </div>
</div>

<script>
let sidebar = document.getElementById('sidebar');
let content = document.getElementById('content');
let modal = document.getElementById('rejectModal');
let modalContent = document.getElementById('modalContent');
let mainArea = document.getElementById('main-area');
let currentRejectId = null;

function toggleSidebar() { sidebar.classList.toggle('hidden'); content.classList.toggle('full'); }

function showHome() { location.reload(); } // reload main dashboard

function showPending() { 
    mainArea.scrollIntoView({behavior:"smooth"});
}

function showActive() { alert("Active PCs view coming soon"); }
function showLogs() { alert("Logs coming soon"); }
function showSettings() { alert("Settings coming soon"); }
function toggleDarkMode() { document.body.classList.toggle('dark-mode'); modalContent.classList.toggle('dark-mode'); }
function logout() { window.location.href = "{{ url_for('logout') }}"; }

function approveUser(userId){
    fetch(`/approve-user/${userId}`, { method:'POST' }).then(res=>res.json()).then(data=>{ location.reload(); });
}

function openRejectModal(userId){ currentRejectId = userId; modal.style.display='flex'; }
function closeRejectModal(){ modal.style.display='none'; currentRejectId=null; document.getElementById('rejectReason').value=''; }
function submitReject(){
    let reason=document.getElementById('rejectReason').value;
    if(!reason){ alert("Enter reason"); return; }
    fetch(`/reject-user/${currentRejectId}`, {
        method:'POST',
        headers:{'Content-Type':'application/x-www-form-urlencoded'},
        body:`reason=${encodeURIComponent(reason)}`
    }).then(res=>res.json()).then(data=>{ closeRejectModal(); location.reload(); });
}
</script>

</body>
</html>
