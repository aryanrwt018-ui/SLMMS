<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pending Approvals - SLMMS</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Poppins', sans-serif;
    background: #f4f6f9;
    margin: 0;
    padding: 20px;
    transition: background 0.3s, color 0.3s;
}
.dark-mode { background:#121212; color:#fff; }
header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 20px;
}
header h2 { margin: 0; }
a { text-decoration: none; color: #4CAF50; font-weight: 600; }
.user-card {
    background: #fff;
    padding: 18px;
    margin-bottom: 15px;
    border-radius: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transition: transform 0.2s, box-shadow 0.2s;
}
.user-card:hover { transform: translateY(-2px); box-shadow:0 6px 18px rgba(0,0,0,0.15); }
.user-info { font-weight: 500; font-size: 16px; }
.actions { display: flex; gap: 10px; flex-wrap: wrap; }
.actions input[type="text"] {
    padding: 6px 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
    min-width: 140px;
}
button {
    padding: 8px 14px;
    border: none;
    border-radius: 5px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s;
}
.approve-btn { background: #27ae60; color: white; }
.approve-btn:hover { background: #219150; }
.reject-btn { background: #e74c3c; color: white; }
.reject-btn:hover { background: #c0392b; }
.modal {
    display: none; position: fixed; top:0; left:0;
    width:100%; height:100%; background: rgba(0,0,0,0.6);
    justify-content: center; align-items: center;
}
.modal-content {
    background: #fff; padding: 20px; border-radius: 10px; width: 320px; text-align:center;
}
.modal-content input {
    width: 100%; padding:10px; margin:10px 0; border-radius:5px; border:1px solid #ccc;
}
.modal-content button { width: 48%; margin:0 1%; }
</style>
</head>
<body>

<header>
    <h2>Pending Approvals</h2>
    <a href="{{ url_for('dashboard') }}">Back to Dashboard</a>
</header>

{% if pending_users %}
    {% for user in pending_users %}
    <div class="user-card">
        <div class="user-info">{{ user[1] }} - {{ user[2] }}</div>
        <div class="actions">
            <form method="POST" action="{{ url_for('approve_user', user_id=user[0]) }}">
                <button type="submit" class="approve-btn">Approve</button>
            </form>
            <button onclick="openRejectModal('{{ user[0] }}')"
                    class="reject-btn">Reject</button>
        </div>
    </div>
    {% endfor %}
{% else %}
<p>No pending users at the moment.</p>
{% endif %}

<div class="modal" id="rejectModal">
    <div class="modal-content">
        <h3>Reject User</h3>
        <input type="text" id="rejectReason" placeholder="Enter rejection reason">
        <div style="display:flex; justify-content:space-between;">
            <button onclick="submitReject()" class="reject-btn">Reject</button>
            <button onclick="closeRejectModal()">Cancel</button>
        </div>
    </div>
</div>

<script>
let modal = document.getElementById('rejectModal');
let currentRejectId = null;

function openRejectModal(userId){
    currentRejectId = userId;
    modal.style.display = 'flex';
}

function closeRejectModal(){
    modal.style.display = 'none';
    currentRejectId = null;
    document.getElementById('rejectReason').value = '';
}

function submitReject(){
    let reason = document.getElementById('rejectReason').value;
    if(!reason){ alert("Please enter a reason"); return; }
    fetch(`/reject-user/${currentRejectId}`, {
        method:'POST',
        headers:{'Content-Type':'application/x-www-form-urlencoded'},
        body:`reason=${encodeURIComponent(reason)}`
    }).then(res=>res.json()).then(data=>{
        if(data.ok){ closeRejectModal(); location.reload(); }
        else alert("Failed to reject user.");
    });
}
</script>

</body>
</html>
